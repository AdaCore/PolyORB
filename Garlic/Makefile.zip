#
# $Id$
#
# Makefile portion for the ZIP filter.
#

ZIPOBJECTS = \
s-gafizi.o

ZIPSOURCES = \
${srcdir}/s-gafizi.ads ${srcdir}/s-gafizi.adb

ZIPLIBOBJS = zlib/adler32.o zlib/compress.o zlib/crc32.o zlib/gzio.o \
	zlib/uncompr.o zlib/deflate.o zlib/trees.o zlib/zutil.o \
	zlib/inflate.o zlib/infblock.o zlib/inftrees.o \
	zlib/infcodes.o zlib/infutil.o zlib/inffast.o

ZIPLIB = zlib/libz.a


$(ZIPLIBOBJS): make-zipdir

$(ZIPLIB): $(ZIPLIBOBJS)
	$(AR) rc $(ZIPLIB) $(ZIPLIBOBJS)

zlib/%.o: $(srcdir)/zlib/%.c
	$(CC) -c -O2 -I$(srcdir)/zlib -o $@ $<

install-zip-libs: $(ZIPLIB)
	${INSTALL} zlib/libz.a ${GARLIC}
	${RANLIB} ${GARLIC}/libz.a

make-zipdir:
	-mkdir zlib 2> /dev/null

ZIPINSTALL=install-zip-libs

FILTERSOBJECTS += $(ZIPOBJECTS) $(ZIPLIB)
FILTERSSOURCES += $(ZIPSOURCES)
FILTERINSTALL  += $(ZIPINSTALL)
