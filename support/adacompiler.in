#! /bin/sh

# Wrapper for GNAT

NATIVE_ADA="@ADA@"
CROSS_ADA="@ADA_FOR_TARGET@"

case "`basename "$0"`" in
  native-*)
    ADA="${NATIVE_ADA}"
    ;;
  *)
    ADA="${CROSS_ADA}"
    ;;
esac

while [ $# -gt 1 ]; do
    case "$1" in
      *.ad[sb])
        src="$1"
	srcdir=`dirname "$src"`
	if [ "x$srcdir" = "x" ]
	then
	  srcdir=.
	fi
        cline="$cline$1 "
        ;;
      -aI*)
        cline="$cline"`echo "$1" | sed s/^-aI/-I/`" "
        ;;
      -aO*)
        ;;
      *)
        cline="$cline$1 "
        ;;
    esac
    shift
done

tmp="tmp$$"
trap "rm -rf $tmp" 0 1 2 3 15
mkdir $tmp
newname=$tmp/`echo $1 | sed -e 's,^\.libs/\(.*\).lo$,\1.o,'`
if grep `basename "$src"` "$srcdir"/gnat.adc.exclude > /dev/null 2>&1
then
  mv gnat.adc gnat.adc-
  $ADA $cline$newname
  mv gnat.adc- gnat.adc
else
  $ADA $cline$newname
fi
mv $newname $1
mv $tmp/* .
