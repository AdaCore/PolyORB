#! /bin/sh
#
# Replaces "-o .libs/foobar.lo" by "-o tmp/foobar.o" then does a move
#

ADA="@ADA@"

while [ $# -gt 1 ]; do
    first=$1
    case "$first" in
      *.ad[sb])
        src="$1"
	srcdir=`dirname "$src"`
	if [ "x$srcdir" = "x" ]
	then
	  srcdir=.
	fi
        ;;
    esac
    shift
    cline="$cline$first "
done

tmp="tmp$$"
trap "rm -rf $tmp" 0 1 2 3 15
mkdir $tmp
newname=$tmp/`echo $1 | sed -e 's,^\.libs/\(.*\).lo$,\1.o,'`
if grep `basename "$src"` "$srcdir"/gnat.adc.exclude > /dev/null 2>&1
then
  mv gnat.adc gnat.adc-
  $ADA $cline$newname
  mv gnat.adc- gnat.adc
else
  $ADA $cline$newname
fi
mv $newname $1
mv $tmp/*.ali .
