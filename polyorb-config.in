#!/bin/sh
# @configure_input@

prefix="@prefix@"
appli="@APPLI_LIST@"
proto="@PROTO_LIST@"
services="@SERVICE_LIST@"

usage()
{
   cat <<EOF
Usage: polyorb-config [OPTIONS]
Options:
        No option:
            Output all the flags (compiler and linker) required
            to compile your program.
        [--prefix[=DIR]]
            Output the directory in which PolyORB architecture-independent 
           files are installed, or set this directory to DIR.
        [--exec-prefix[=DIR]]
            Output the directory in which PolyORB architecture-dependent 
           files are installed, or set this directory to DIR.
        [--version|-v]
            Output the version of PolyORB.
        [--config]
            Output PolyORB's configuration parameters.
        [--libs]
            Output the linker flags to use for PolyORB.
        [--cflags]
            Output the compiler flags to use for PolyORB.
        [--idls]
            Output flags to set up path to CORBA's IDL for idlac.
        [--help]
            Output this message
EOF
}

while test $# -gt 0; do
  case "$1" in
  -*=*) optarg=`echo "$1" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
  *) optarg= ;;
  esac

  case $1 in
    --help|-h)
      usage 1>&2
      exit 1
      ;;
    --prefix=*)
      prefix=$optarg;
      if test "x$exec_prefix_set" = x ; then
	  exec_prefix=$prefix
      fi
      ;;
    --prefix)
      echo_prefix=true      
      ;;
    --exec-prefix=*)
      exec_prefix=$optarg
      ;;
    --exec-prefix)
      echo_exec_prefix=true
      ;;
    --version|-v)
      echo "PolyORB @VERSION@"
      exit 0
      ;;
    --config)
      echo "Personalities built :" 
      echo "* Application personalities : " $appli
      echo "* Protocol    personalities : " $proto
      echo "* Services                  : " $services
      exit 0
      ;;  
    --libs)
      echo_libs=true
      ;;
    --idls)
      echo_idls=true
      ;;
    --cflags)
      echo_cflags=true
      ;;
    *)
      usage 1>&2
      exit 1
      ;;
  esac
  shift
done

exec_prefix="@exec_prefix@"
includedir="@includedir@"
libdir="@libdir@"
polyorb_dir="@XMLADA_INCS@ -I${includedir}/polyorb"
polyorb_lib="@XMLADA_LIBS@ -L${libdir}"
corba_idl_dir=""

for P in $appli
do
 polyorb_dir="$polyorb_dir -I${includedir}/polyorb/${P}"
 polyorb_lib="$polyorb_lib -lpolyorb-${P}"

 if [ "x$P" = "xcorba" ]
 then
   polyorb_dir="$polyorb_dir -I${includedir}/polyorb/corba/cos -I${includedir}/polyorb/corba/messaging -I${includedir}/polyorb/corba/portableinterceptor -I${includedir}/polyorb/corba/rtcorba"
   polyorb_lib="$polyorb_lib -lpolyorb-corba-messaging -lpolyorb-corba-portableinterceptor -lpolyorb-corba-rtcorba"
   polyorb_lib="$polyorb_lib -lpolyorb-corba-cos-event -lpolyorb-corba-cos-naming -lpolyorb-corba-cos-time"
   for S in $services
   do
      polyorb_lib="$polyorb_lib -lpolyorb-corba-cos-${S}-impl"
   done
   corba_idl_dir="-I${includedir}/polyorb/corba/cos"
 fi 

 if [ "x$P" = "xaws" ]
 then
   polyorb_dir="$polyorb_dir -I${includedir}/polyorb/web_common"
   polyorb_lib="$polyorb_lib -lpolyorb-web_common"
 fi 
done

for P in $proto
do
 polyorb_dir="$polyorb_dir -I${includedir}/polyorb/${P}"
 polyorb_lib="$polyorb_lib -lpolyorb-${P}"

 if [ "x$P" = "xgiop" ]
 then
   polyorb_dir="$polyorb_dir -I${includedir}/polyorb/giop/diop -I${includedir}/polyorb/giop/iiop -I${includedir}/polyorb/giop/miop"
   polyorb_lib="$polyorb_lib -lpolyorb-giop-diop -lpolyorb-giop-iiop -lpolyorb-giop-miop"  
 fi

 if [ "x$P" = "xsoap" ]
 then
   polyorb_dir="$polyorb_dir -I${includedir}/polyorb/web_common"
   polyorb_lib="$polyorb_lib -lpolyorb-web_common"
 fi
done

if test ! x"$echo_prefix" = x"true"  -a ! x"$echo_exec_prefix" = x"true" -a ! x"$echo_cflags" = x"true" -a ! x"$echo_libs" = x"true" -a ! x"$echo_idls" = x"true"; then
   echo $polyorb_dir -largs $polyorb_lib
fi

if test x"$echo_prefix" = x"true" ; then
    echo $prefix
fi
if test x"$echo_exec_prefix" = x"true" ; then
    echo $exec_prefix
fi

if test x"$echo_cflags" = x"true"; then
    echo $polyorb_dir 
fi

if test x"$echo_libs" = x"true"; then
    echo $polyorb_lib
fi

if test x"$echo_idls" = x"true"; then
    echo $corba_idl_dir
fi

